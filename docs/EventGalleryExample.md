# Event Gallery Example

This example shows how to add a gallery to a calendar event. The intco template toolkit (TT from now on) will be used to easily output the gallery in the frontend template. 

The gallery will be a standard Gallery content element and its options will be set visually by creating a Contao content element through the backend.

In order to follow the steps you need to create a directory inside Contao system/modules. This directory will contain all the files below

## First step: be sure our extension will be loaded after the calendar extension
> Path: config/autoload.ini

```ini
; List modules which are required to be loaded beforehand
;;
requires[] = "core"
requires[] = "calendar"
```

## Second step: add the gallerysrc field to the dca and the field to the default palette
> Path: dca/tl_calendar_events.php

```php
$GLOBALS['TL_DCA']['tl_calendar_events']['fields']['gallerysrc'] = array(
	'label'                   => $GLOBALS['TL_LANG']['tl_calendar_events']['gallerysrc'],
	'exclude'                 => false,
	'inputType'               => 'fileTree',
	'eval'                    => array(
		'multiple'=>true, 
		'fieldType'=>'checkbox', 
		'files'=>true, 
		'isGallery' => true, 
		'orderField' => 'orderSRC'
	),
	'sql'                     => "blob NULL",
);

$GLOBALS['TL_DCA']['tl_calendar_events']['fields']['orderSRC'] = array(
	'label'                   => &$GLOBALS['TL_LANG']['MSC']['sortOrder'],
	'sql'                     => "blob NULL"
);

$GLOBALS['TL_DCA']['tl_calendar_events']['palettes']['default'] = $GLOBALS['TL_DCA']['tl_calendar_events']['palettes']['default'].';gallerysrc';
```

## Third step: add the language file
> Path: languages/en/tl_calendar_events.php

```php
$GLOBALS['TL_LANG']['tl_calendar_events']['gallerysrc'] = array('Gallery', "Seleziona some images");
```

## Fourth step: Configure the gallery through the Contao backend and obtain the PHP code

- Create a Page named "TT Sandbox" and **dont't publish it**
- Inside the TT Sandbox *article* create new content element as shown below and set the options as you wish. 

> Note that you can freely select only one random element for the **Source files** field because we will be replace it later with the `gallerysrc` field of the event.

![img.edit-content-gallery]

Once saved the record click on the ![ico.export-content] icon.

![img.record-listview]

Copy the auto generated code and

![img.exported-php-code]

Paste inside a file named `gallery_event.html5` under the `templates` directory alongside your `event_full.html5` template.

Now replace the `source files` section of the configuration with ...

```php
/* Source files - Please select one or more files or folders from the files directory. If you select a folder, its files will be included automatically. */
    'multiSRC' => serialize(array(
        base64_decode('i4k2nkXhEemOL9BQmSizgA=='),
        base64_decode('i/jlsUXhEemOL9BQmSizgA=='),
        base64_decode('iz0l3UXhEemOL9BQmSizgA=='),
    )),
```

... the value from the `gallerysrc` field

```php
/* Source files - Please select one or more files or folders from the files directory. If you select a folder, its files will be included automatically. */
    'multiSRC' => $this->gallerysrc,
```

Then open the `event_full.html5` template and add the following code wherever you want to show the gallery.

```php
<?php include __DIR__.'/gallery_event.html5'; ?>
```

The gallery will then be shown inside the page containing the event reader module

# TT in details

The generated code reflects the label and description of each field available through the backend. 

A comment showing the label and description of each field is shown above the array entry

| Content element edit inteface | TT autogenerated code |
|--------------------|-----------------------|
| ![img.edit-content-gallery] | ![img.autogenerated-code] |

Once the code is generated you can freely modify it (e.g. adding a css class or id) since it is not linked to the source element. 


[example-event-gallery]: ./docs/EventGalleryExample.md "Example Event Gallery"
[img.edit-content-gallery]: ./assets/edit-content-gallery.jpg "Edit content gallery"
[img.record-listview]: ./assets/record-listview.jpg "List view"
[img.exported-php-code]: ./assets/exported-php-code.jpg "Exported PHP code"
[img.autogenerated-code]: ./assets/autogenerated-code.jpg "Exported PHP code"
[ico.export-content]: ./assets/exportcode.gif "Export code icon"